<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Urdu Document Editor</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jameel+Noori+Nastaleeq&display=swap" rel="stylesheet">
    
    <style>
        /* --- NEW FONT DEFINITION --- */
        /* Define the local Faiz Lahori Nastaleeq font face */
        @font-face {
            font-family: 'Faiz Lahori Nastaleeq';
            src: url('fonts/Faiz_Lahori_Nastaleeq_Regular.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        /* A4 dimensions (approximate pixels for 96 DPI) */
        :root {
            --a4-width-px: 794px;   
            --a4-height-px: 1123px; 
            --page-margin-cm: 2cm;  
            --page-padding: 75px;   
        }
        
        /* --- General Styling --- */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f7f9;
        }

        h2 {
            text-align: center;
            color: #1a5276;
            font-family: 'Jameel Noori Nastaleeq', Arial, sans-serif;
            margin-bottom: 30px;
        }

        /* --- Toolbars Container --- */
        #toolbars-container {
            max-width: var(--a4-width-px);
            margin: 0 auto 15px auto;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        #rich-content-toolbar, #formatting-toolbar {
            display: flex;
            align-items: center;
            padding: 5px 0;
        }

        /* --- Toolbar Buttons --- */
        .tool-btn, .format-btn, .font-select {
            background-color: #5d98bc;
            color: white;
            border: none;
            padding: 8px 15px;
            margin-right: 5px; 
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            transition: background-color 0.2s;
        }
        .tool-btn:hover, .format-btn:hover {
            background-color: #3b7496;
        }
        .format-btn {
            padding: 8px 12px;
            font-size: 18px; 
        }

        /* Styling for the Bold Button */
        #bold-btn { font-weight: bold; font-size: 20px; }
        #pdf-btn { background-color: #e74c3c; }
        #pdf-btn:hover { background-color: #c0392b; }

        /* Styling for Font Dropdowns */
        #font-size-select, #font-family-select {
            padding: 8px; border-radius: 5px; border: 1px solid #ccc;
            margin-right: 10px; font-size: 16px; background-color: white;
            color: #333; cursor: pointer;
        }
        #font-family-select { min-width: 120px; }

        /* Styling for the Color Picker */
        #color-picker {
            width: 38px;
            height: 38px;
            padding: 2px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
        }

        /* --- Document Editor Area (A4 Styling) --- */
        #document-editor {
            /* Set A4 dimensions and center it */
            width: var(--a4-width-px);
            min-height: var(--a4-height-px);
            height: auto; 
            margin: 20px auto; 
            
            /* THIS IS THE VISUAL MARGIN */
            padding: var(--page-padding); 
            
            border: 1px solid #ccc;
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); 
            
            /* Urdu Default Styles */
            direction: rtl; 
            text-align: right;
            font-family: 'Jameel Noori Nastaleeq', 'Simplified Arabic', sans-serif;
            font-size: 24px; 
            line-height: 1.8;
            outline: none; 
            word-wrap: break-word; 
        }

        /* --- Page Break Marker Styling --- */
        .page-break {
            height: 1px;
            margin: 30px 0;
            border-bottom: 2px dashed #bbb;
            text-align: center;
            color: #888;
            font-size: 14px;
            position: relative;
        }
        .page-break::after {
            content: 'ØµÙØ­Û ÙˆÙ‚ÙÛ'; /* Page Break in Urdu */
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #f4f7f9;
            padding: 0 10px;
        }
        
        /* --- Virtual Keyboard Layout --- */
        #keyboard-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-end; 
            max-width: var(--a4-width-px);
            margin: 0 auto 30px auto;
            border-radius: 8px;
            padding: 10px;
            background-color: #e8eef2;
            border: 1px solid #ddd;
        }

        .urdu-key {
            background-color: #ffffff;
            color: #333;
            border: 1px solid #ccc;
            margin: 3px;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 24px;
            font-family: 'Jameel Noori Nastaleeq', Arial, sans-serif;
            min-width: 45px;
            text-align: center;
            line-height: 1.2;
            transition: background-color 0.1s, transform 0.1s;
        }

        .urdu-key span { 
            display: block; 
            font-size: 14px; 
            font-family: Arial, sans-serif; 
            color: #555; 
            margin-top: 3px;
        }
        
        /* --- PRINT-SPECIFIC STYLES (Content Only, with margin) --- */
        @media print {
            body {
                margin: 0;
            }
            body > * {
                visibility: hidden; 
            }
            
            #document-editor {
                visibility: visible;
                position: absolute;
                left: 0;
                top: 0;
                
                width: 210mm; 
                min-height: 297mm; 
                margin: 0;
                box-shadow: none;
                border: none;
                overflow: visible !important;
                
                /* THIS IS THE CRUCIAL PRINT MARGIN */
                padding: var(--page-margin-cm); 
            }
            
            .page-break {
                height: 0;
                border: none !important;
                page-break-before: always;
                content: '';
                visibility: visible !important;
            }
            .page-break::after {
                content: none;
            }
            #document-editor, #document-editor * {
                visibility: visible; 
            }
        }

    </style>
</head>
<body>

    <h2>Ø§Ø±Ø¯Ùˆ Ø¢Ù† Ù„Ø§Ø¦Ù† ÚˆØ§Ú©ÙˆÙ…Ù†Ù¹ Ø§ÛŒÚˆÛŒÙ¹Ø± â€¢ Online Urdu Document Editor</h2>
    
    <div id="toolbars-container">
        
        <div id="rich-content-toolbar">
            <button class="tool-btn" onclick="insertImage()">ğŸ–¼ï¸ Insert Image (Local)</button>
            <button class="tool-btn" onclick="insertTable()">ğŸ“… Table</button>
            <button class="tool-btn" onclick="insertShape()">â¬› Shape/Box</button>
            <button class="tool-btn" id="pdf-btn" onclick="saveToPdf()">ğŸ“„ Save to PDF</button> 
            <button class="tool-btn" onclick="saveDocument()">ğŸ’¾ Save HTML</button>
        </div>

        <div id="formatting-toolbar">
            <button class="format-btn" id="bold-btn" onclick="formatDoc('bold')">**B**</button> 
            
            <input type="color" id="color-picker" title="Text Color" value="#333333">
            
            <select id="font-family-select" title="Font Family">
                <option value="" disabled selected>ÙÙˆÙ†Ù¹</option>
            </select>
            
            <select id="font-size-select" title="Font Size">
                <option value="" disabled selected>Ø³Ø§Ø¦Ø² (px)</option>
            </select>
            
            <button class="format-btn" onclick="formatDoc('justifyLeft')">â¬…ï¸ Align Left</button>
            <button class="format-btn" onclick="formatDoc('justifyCenter')">â” Align Center</button>
            <button class="format-btn" onclick="formatDoc('justifyRight')">â¡ï¸ Align Right</button>
            <button class="format-btn" onclick="formatDoc('justifyFull')">Î Justify</button>
            <button class="format-btn" onclick="formatDoc('insertUnorderedList')">â€¢ Bullets</button>
            <button class="format-btn" onclick="formatDoc('insertOrderedList')"># Numbering</button>
        </div>
    </div>
    
    <div 
        id="document-editor" 
        contenteditable="true" 
        dir="rtl" 
        placeholder="ÛŒÛØ§Úº Ù„Ú©Ú¾Ù†Ø§ Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº... Use your Latin keyboard phonetically (a=Ø§, p=Ù¾, etc.)"
    ></div>

    <div id="keyboard-container" dir="rtl">
        
        <button class="urdu-key" data-char="Ø§">Ø§<span>a</span></button>
        <button class="urdu-key" data-char="Ø¢">Ø¢<span>A</span></button>
        <button class="urdu-key" data-char="Ø¨">Ø¨<span>b</span></button>
        <button class="urdu-key" data-char="Ù¾">Ù¾<span>p</span></button>
        <button class="urdu-key" data-char="Øª">Øª<span>t</span></button>
        <button class="urdu-key" data-char="Ù¹">Ù¹<span>T</span></button>
        <button class="urdu-key" data-char="Ø«">Ø«<span>C</span></button>
        <button class="urdu-key" data-char="Ø¬">Ø¬<span>j</span></button>
        <button class="urdu-key" data-char="Ú†">Ú†<span>c</span></button>
        <button class="urdu-key" data-char="Ø­">Ø­<span>H</span></button>
        <button class="urdu-key" data-char="Ø®">Ø®<span>K</span></button>
        <button class="urdu-key" data-char="Ø¯">Ø¯<span>d</span></button>
        <button class="urdu-key" data-char="Úˆ">Úˆ<span>D</span></button>
        <button class="urdu-key" data-char="Ø°">Ø°<span>Z</span></button>
        <button class="urdu-key" data-char="Ø±">Ø±<span>r</span></button>
        <button class="urdu-key" data-char="Ú‘">Ú‘<span>R</span></button>
        <button class="urdu-key" data-char="Ø²">Ø²<span>z</span></button>
        <button class="urdu-key" data-char="Ú˜">Ú˜<span>x</span></button>
        <button class="urdu-key" data-char="Ø³">Ø³<span>s</span></button>
        <button class="urdu-key" data-char="Ø´">Ø´<span>S</span></button>
        <button class="urdu-key" data-char="Øµ">Øµ<span>q</span></button>
        <button class="urdu-key" data-char="Ø¶">Ø¶<span>X</span></button>
        <button class="urdu-key" data-char="Ø·">Ø·<span>I</span></button>
        <button class="urdu-key" data-char="Ø¸">Ø¸<span>O</span></button>
        <button class="urdu-key" data-char="Ø¹">Ø¹<span>e</span></button>
        <button class="urdu-key" data-char="Øº">Øº<span>G</span></button>
        <button class="urdu-key" data-char="Ù">Ù<span>f</span></button>
        <button class="urdu-key" data-char="Ù‚">Ù‚<span>Q</span></button>
        <button class="urdu-key" data-char="Ú©">Ú©<span>k</span></button>
        <button class="urdu-key" data-char="Ú¯">Ú¯<span>g</span></button>
        <button class="urdu-key" data-char="Ù„">Ù„<span>l</span></button>
        <button class="urdu-key" data-char="Ù…">Ù…<span>m</span></button>
        <button class="urdu-key" data-char="Ù†">Ù†<span>n</span></button>
        <button class="urdu-key" data-char="Úº">Úº<span>N</span></button>
        <button class="urdu-key" data-char="Ùˆ">Ùˆ<span>w/u/v</span></button>
        <button class="urdu-key" data-char="Û">Û<span>h</span></button>
        <button class="urdu-key" data-char="Ú¾">Ú¾<span>Hh</span></button>
        <button class="urdu-key" data-char="ÛŒ">ÛŒ<span>i/y</span></button>
        <button class="urdu-key" data-char="Û’">Û’<span>Y/E</span></button>
        <button class="urdu-key" data-char="Ø¦">Ø¦<span>E</span></button> 
        
        <button class="urdu-key special" data-char="Û“">Û“<span>Y</span></button>  <button class="urdu-key special" data-char="Ø¤">Ø¤<span>O</span></button>  <button class="urdu-key special" data-char="Ø¡">Ø¡<span>'</span></button>  <button class="urdu-key special" data-char="Û”">Û”<span>.</span></button>  <button class="urdu-key special" data-char="Ø›">Ø›<span>;</span></button>  <button class="urdu-key special" data-char="ØŸ">ØŸ<span>?</span></button>
        <button class="urdu-key special" data-char="!">!<span>!</span></button>
        <button class="urdu-key special" data-char="ØŒ">ØŒ<span>,</span></button>
        
        <button class="urdu-key special" data-char="Û°">Û°<span>0</span></button>
        <button class="urdu-key special" data-char="Û±">Û±<span>1</span></button>
        <button class="urdu-key special" data-char="Û²">Û²<span>2</span></button>
        <button class="urdu-key special" data-char="Û³">Û³<span>3</span></button>
        <button class="urdu-key special" data-char="Û´">Û´<span>4</span></button>
        <button class="urdu-key special" data-char="Ûµ">Ûµ<span>5</span></button>
        <button class="urdu-key special" data-char="Û¶">Û¶<span>6</span></button>
        <button class="urdu-key special" data-char="Û·">Û·<span>7</span></button>
        <button class="urdu-key special" data-char="Û¸">Û¸<span>8</span></button>
        <button class="urdu-key special" data-char="Û¹">Û¹<span>9</span></button>

        <button class="urdu-key space" data-char=" ">Space</button>
        <button class="urdu-key special" onclick="document.execCommand('undo', false, null)">â†©ï¸ Undo</button>
        <button class="urdu-key special" onclick="document.execCommand('delete', false, null)">âŒ Backspace</button>
        <button class="urdu-key special" data-char="\n">â Enter</button>
        
    </div>

<script>
    const editor = document.getElementById('document-editor');
    const keys = document.querySelectorAll('.urdu-key');
    const fontFamilySelect = document.getElementById('font-family-select');
    const colorPicker = document.getElementById('color-picker'); 

    // Define A4 height for calculation
    const A4_HEIGHT_PX = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--a4-height-px'));
    const PAGE_PADDING_PX = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--page-padding'));
    const USABLE_PAGE_HEIGHT = A4_HEIGHT_PX; 

    // --- 1. Phonetic Key Mapping ---
    // NOTE: 'e' is mapped to 'Ø¹', so 'E' (Shift+E) is used for 'Ø¦'.
    // 'y' is mapped to 'ÛŒ', and 'Y' (Shift+Y) is mapped to 'Û’'.
    // 'O' (Shift+O) is used for 'Ø¤'.
    const phoneticMap = {
        'a': 'Ø§', 'b': 'Ø¨', 'p': 'Ù¾', 't': 'Øª', 'j': 'Ø¬', 'c': 'Ú†', 'H': 'Ø­', 
        'k': 'Ú©', 'g': 'Ú¯', 'l': 'Ù„', 'm': 'Ù…', 'n': 'Ù†', 'd': 'Ø¯', 'r': 'Ø±', 
        'z': 'Ø²', 's': 'Ø³', 'S': 'Ø´', 'x': 'Øµ', 'f': 'Ù', 'q': 'Ù‚', 
        'v': 'Ùˆ', 'w': 'Ùˆ', 'u': 'Ùˆ', 'i': 'ÛŒ', 'y': 'ÛŒ', 'e': 'Ø¹',
        'h': 'Û', 
        
        'A': 'Ø¢',   'T': 'Ù¹',   'D': 'Úˆ',   'R': 'Ú‘',   'Z': 'Ø°',   'X': 'Ø¶',   
        'I': 'Ø·',   'E': 'Ø¦',   'G': 'Øº',   'N': 'Úº',   'O': 'Ø¤',   'Y': 'Û’',   
        'C': 'Ø«',   

        "'": 'Ø¡',   ';': 'Ø›',   

        ',': 'ØŒ', '.': 'Û”', '?': 'ØŸ', '!': '!',
        '0': 'Û°', '1': 'Û±', '2': 'Û²', '3': 'Û³', '4': 'Û´', 
        '5': 'Ûµ', '6': 'Û¶', '7': 'Û·', '8': 'Û¸', '9': 'Û¹',
        ' ': ' ' 
    };

    // --- 2. Keyboard Input Logic ---
    keys.forEach(key => {
        key.addEventListener('click', () => {
            const char = key.getAttribute('data-char');
            if (char) {
                editor.focus();
                document.execCommand('insertText', false, char);
                checkPageBreak(); 
            }
        });
    });

    // --- 3. Physical Keyboard Typing Logic ---
    editor.addEventListener('keydown', (event) => {
        let key = event.key;
        let urduChar = null;

        if (event.shiftKey) {
            // Check for Shifted keys (Shift+Y, Shift+E, Shift+O, etc.)
            if (phoneticMap.hasOwnProperty(key.toUpperCase())) {
                 urduChar = phoneticMap[key.toUpperCase()];
            } else if (key === 'h') {
                urduChar = 'Ú¾'; // Shift + H for Do Chashmi Heh
            }
        } 
        
        // Handling the standard (lowercase) and single-key punctuation
        if (urduChar === null && phoneticMap.hasOwnProperty(key)) {
            urduChar = phoneticMap[key];
        }

        if (urduChar !== null && key.length <= 1 && !event.ctrlKey && !event.altKey) {
            event.preventDefault(); 
            document.execCommand('insertText', false, urduChar);
        }
    });
    
    // --- 4. Auto Page Break Logic ---
    function checkPageBreak() {
        const scrollHeight = editor.scrollHeight; 
        const requiredBreaks = Math.floor(scrollHeight / USABLE_PAGE_HEIGHT);

        const pageBreaks = Array.from(editor.querySelectorAll('.page-break'));

        for (let i = pageBreaks.length; i < requiredBreaks; i++) {
            const breakDiv = document.createElement('div');
            breakDiv.className = 'page-break';
            editor.appendChild(breakDiv);
        }
    }
    
    editor.addEventListener('input', checkPageBreak);
    
    // --- 5. Image Resizing Toggles ---
    editor.addEventListener('focus', () => {
        document.execCommand('enableObjectResizing', true, 'true');
    });
    editor.addEventListener('blur', () => {
        document.execCommand('enableObjectResizing', false, 'false');
    });
    editor.addEventListener('mouseup', () => {
        document.execCommand('enableObjectResizing', true, 'true');
    });


    // --- 6. Formatting Command Function ---
    function formatDoc(command) {
        editor.focus();
        document.execCommand(command, false, null);
        checkPageBreak();
    }

    // --- 7. Font Size and Family Logic ---
    
    function createFontSizeOptions() {
        const select = document.getElementById('font-size-select');
        for (let i = 8; i <= 100; i += (i < 24 ? 2 : 4)) {
            const option = document.createElement('option');
            option.value = i + 'px';
            option.textContent = i + ' px';
            select.appendChild(option);
        }
    }
    
    function createFontFamilyOptions() {
        const fonts = [
            { name: 'ÙÛŒØ¶ Ù„Ø§ÛÙˆØ±ÛŒ Ù†Ø³ØªØ¹Ù„ÛŒÙ‚ (Faiz Lahori)', value: 'Faiz Lahori Nastaleeq, serif' },
            { name: 'Ø¬Ù…ÛŒÙ„ Ù†ÙˆØ±ÛŒ Ù†Ø³ØªØ¹Ù„ÛŒÙ‚ (Jameel Noori)', value: 'Jameel Noori Nastaleeq, serif' },
            { name: 'Arial (Standard)', value: 'Arial, sans-serif' },
            { name: 'Times New Roman (Standard)', value: 'Times New Roman, serif' },
            { name: 'Simplified Arabic (Arabic)', value: 'Simplified Arabic, sans-serif' },
            { name: 'Courier New (Monospace)', value: 'Courier New, monospace' }
        ];

        fonts.forEach(font => {
            const option = document.createElement('option');
            option.value = font.value;
            option.textContent = font.name;
            option.style.fontFamily = font.value;
            option.style.direction = font.value.includes('Nastaleeq') || font.value.includes('Arabic') ? 'rtl' : 'ltr';
            fontFamilySelect.appendChild(option);
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        createFontSizeOptions();
        createFontFamilyOptions();
        document.execCommand('styleWithCSS', false, true); 
    });
    
    document.getElementById('font-size-select').addEventListener('change', function() {
        const sizeValue = this.value; 
        if (sizeValue) {
            editor.focus();
            
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const content = range.extractContents();
                
                const span = document.createElement('span');
                span.style.fontSize = sizeValue;
                span.appendChild(content);
                
                range.insertNode(span);
                selection.removeAllRanges();
            }
            this.selectedIndex = 0; 
            checkPageBreak();
        }
    });

    fontFamilySelect.addEventListener('change', function() {
        const fontName = this.value; 
        if (fontName) {
            editor.focus();
            document.execCommand('fontName', false, fontName);
            this.selectedIndex = 0; 
            checkPageBreak();
        }
    });

    // --- Color Picker Logic ---
    colorPicker.addEventListener('input', function() {
        const colorValue = this.value;
        editor.focus();
        document.execCommand('foreColor', false, colorValue);
        checkPageBreak();
    });


    // --- 8. Conversion Function ---
    const CM_TO_PX_RATIO = 37.79527559; 
    function cmToPx(cm) {
        return Math.round(cm * CM_TO_PX_RATIO);
    }
    
    // --- 9. Rich Content Insertion Functions ---

    function insertImage() {
        const dimInput = prompt("Ø§ÙˆÙ†Ú†Ø§Ø¦ÛŒ Ø§ÙˆØ± Ú†ÙˆÚ‘Ø§Ø¦ÛŒ Ø³ÛŒÙ†Ù¹ÛŒ Ù…ÛŒÙ¹Ø± Ù…ÛŒÚº Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚºØŒ Ú©ÙˆÙ…Ø§ Ø³Û’ Ø§Ù„Ú¯ Ú©Ø±ÛŒÚº (e.g., 5, 8):", "5, 5");
        if (!dimInput) return;

        const dims = dimInput.split(',').map(d => parseFloat(d.trim()));
        
        let height = dims[0];
        let width = dims.length > 1 ? dims[1] : height; 

        if (isNaN(height) || height <= 0 || isNaN(width) || width <= 0) {
            alert("Ø§ÙˆÙ†Ú†Ø§Ø¦ÛŒ Ø§ÙˆØ± Ú†ÙˆÚ‘Ø§Ø¦ÛŒ Ú©ÛŒ Ø¯Ø±Ø³Øª Ù‚Ø¯Ø±ÛŒÚº Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº (Please enter valid positive numbers for dimensions).");
            return;
        }

        const heightPx = cmToPx(height);
        const widthPx = cmToPx(width);

        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        
        input.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (readerEvent) => {
                    const dataUrl = readerEvent.target.result;
                    editor.focus();
                    
                    const imgHTML = `<img src="${dataUrl}" style="height:${heightPx}px; width:${widthPx}px; margin: 5px; float: right;" alt="User Image">`;
                    
                    document.execCommand('insertHTML', false, imgHTML);
                    checkPageBreak();
                };
                reader.readAsDataURL(file);
            }
        };

        input.click();
    }

    function insertTable() {
        const dimInput = prompt("Ù‚Ø·Ø§Ø±ÛŒÚº Ø§ÙˆØ± Ú©Ø§Ù„Ù…ÙˆÚº Ú©ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚºØŒ Ú©ÙˆÙ…Ø§ Ø³Û’ Ø§Ù„Ú¯ Ú©Ø±ÛŒÚº (e.g., 4, 3):", "3, 3");
        if (!dimInput) return;

        const dims = dimInput.split(',').map(d => parseInt(d.trim()));
        
        let rows = dims[0];
        let cols = dims.length > 1 ? dims[1] : dims[0];

        if (isNaN(rows) || rows <= 0 || isNaN(cols) || cols <= 0) {
            alert("Ù‚Ø·Ø§Ø±ÙˆÚº Ø§ÙˆØ± Ú©Ø§Ù„Ù…ÙˆÚº Ú©ÛŒ Ø¯Ø±Ø³Øª ØªØ¹Ø¯Ø§Ø¯ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº (Please enter valid positive numbers for rows and columns).");
            return;
        }

        let tableHTML = `<table border="1" style="width: 100%; margin: 15px 0; border-collapse: collapse; text-align: right; direction: rtl;">`;
        tableHTML += '<tr>';
        for (let i = 1; i <= cols; i++) {
            tableHTML += `<th style="padding: 10px; background-color: #eee;">Ø³Ø±Ø®ÛŒ ${i}</th>`;
        }
        tableHTML += '</tr>';

        for (let r = 1; r < rows; r++) { 
            tableHTML += '<tr>';
            for (let c = 1; c <= cols; c++) {
                tableHTML += `<td style="padding: 8px;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</td>`;
            }
            tableHTML += '</tr>';
        }

        tableHTML += '</table>';

        editor.focus();
        document.execCommand('insertHTML', false, tableHTML);
        checkPageBreak();
    }

    function insertShape() {
        const shapeHTML = `
            <div style="border: 3px solid #1a5276; padding: 15px; margin: 15px; background-color: #e6f3fa; border-radius: 8px; font-weight: bold; width: fit-content; direction: rtl; display: inline-block;">
                Ø¶Ø±ÙˆØ±ÛŒ Ù†ÙˆÙ¹: ÛŒÛØ§Úº Ø§ÛÙ… Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ú©Ú¾ÛŒÚº
            </div>
        `;
        editor.focus();
        document.execCommand('insertHTML', false, shapeHTML);
        checkPageBreak();
    }

    // --- 10. Save Functions ---
    
    function saveDocument() {
        const content = editor.innerHTML;
        const blob = new Blob([content], { type: 'text/html;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = 'Urdu_Document.html';
        
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        URL.revokeObjectURL(url);
        
        alert("Document saved as Urdu_Document.html! (ÚˆØ§Ú©ÙˆÙ…ÛŒÙ†Ù¹ Ù…Ø­ÙÙˆØ¸ ÛÙˆ Ú¯ÛŒØ§)");
    }
    
    function saveToPdf() {
        editor.focus(); 
        alert("Ø¨Ø±Ø§Ø¦Û’ Ù…ÛØ±Ø¨Ø§Ù†ÛŒ Ù¾Ø±Ù†Ù¹ Ù…ÛŒÙ†ÛŒÙˆ Ù…ÛŒÚº 'Save as PDF' Ú©Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø±ÛŒÚºÛ”\nPlease select 'Save as PDF' in the print menu.");
        window.print();
    }

</script>
</body>
</html>
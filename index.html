<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urdu Editor: Full Keyboard</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jameel+Noori+Nastaleeq&display=swap" rel="stylesheet">
    
    <style>
        /* --- FONT DEFINITIONS --- */
        @font-face {
            font-family: 'Faiz Lahori Nastaleeq';
            src: url('fonts/Faiz_Lahori_Nastaleeq_Regular.ttf') format('truetype');
            font-weight: normal; font-style: normal;
        }

        /* --- PAGE SETTINGS (A4) --- */
        :root {
            --a4-width-px: 794px;   
            --a4-height-px: 1123px; 
            --page-margin-cm: 2cm;  
            --page-padding: 75px;   
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f7f9;
        }

        h2 {
            text-align: center; color: #1a5276;
            font-family: 'Jameel Noori Nastaleeq', Arial, sans-serif;
            margin-bottom: 30px;
        }

        /* --- TOOLBARS --- */
        #toolbars-container {
            max-width: var(--a4-width-px);
            margin: 0 auto 15px auto;
            display: flex; justify-content: space-between;
            flex-wrap: wrap; gap: 10px;
        }
        
        #rich-content-toolbar, #formatting-toolbar {
            display: flex; align-items: center; flex-wrap: wrap; gap: 5px;
        }

        .tool-btn, .format-btn {
            background-color: #5d98bc; color: white;
            border: none; padding: 8px 15px;
            cursor: pointer; border-radius: 5px;
            font-size: 16px; transition: background-color 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .tool-btn:hover, .format-btn:hover { background-color: #3b7496; }
        
        #bold-btn { font-weight: bold; }
        #pdf-btn { background-color: #e74c3c; }
        #pdf-btn:hover { background-color: #c0392b; }
        #new-doc-btn { background-color: #f39c12; }
        #new-doc-btn:hover { background-color: #d35400; }
        #watermark-btn { background-color: #8e44ad; }
        #watermark-btn:hover { background-color: #732d91; }

        #font-size-select, #font-family-select {
            padding: 8px; border-radius: 5px; border: 1px solid #ccc;
            font-size: 16px; background-color: white; cursor: pointer;
        }
        #color-picker {
            width: 38px; height: 38px; padding: 2px;
            border: 1px solid #ccc; border-radius: 5px; cursor: pointer;
        }
        
        #save-status {
            margin-left: 10px; font-size: 14px; font-weight: bold; min-width: 80px;
        }

        /* --- DOCUMENT EDITOR --- */
        #document-editor {
            width: var(--a4-width-px); min-height: var(--a4-height-px);
            margin: 20px auto; padding: var(--page-padding); 
            border: 1px solid #ccc; background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); 
            direction: rtl; text-align: right;
            font-family: 'Jameel Noori Nastaleeq', 'Simplified Arabic', sans-serif;
            font-size: 24px; line-height: 1.8;
            outline: none; word-wrap: break-word; 
            position: relative; z-index: 1;
        }

        #document-editor::after {
            content: attr(data-watermark);
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 120px; color: rgba(0, 0, 0, 0.08);
            white-space: nowrap; pointer-events: none; z-index: -1;
            font-family: Arial, sans-serif; font-weight: bold;
        }

        .page-break {
            height: 1px; margin: 30px 0; border-bottom: 2px dashed #bbb; position: relative;
        }
        .page-break::after {
            content: 'ØµÙØ­Û ÙˆÙ‚ÙÛ (Page Break)';
            position: absolute; top: -12px; left: 50%; transform: translateX(-50%);
            background: #f4f7f9; padding: 0 10px; font-size: 12px; color: #888;
        }
        
        /* --- VIRTUAL KEYBOARD --- */
        #keyboard-container {
            display: flex; flex-wrap: wrap; justify-content: flex-end; 
            max-width: var(--a4-width-px); margin: 0 auto 30px auto;
            border-radius: 8px; padding: 10px;
            background-color: #e8eef2; border: 1px solid #ddd;
        }

        .urdu-key {
            background-color: #ffffff; color: #333;
            border: 1px solid #ccc; margin: 3px; padding: 5px 10px;
            cursor: pointer; border-radius: 4px;
            font-size: 24px; font-family: 'Jameel Noori Nastaleeq', Arial, sans-serif;
            min-width: 45px; text-align: center; transition: transform 0.1s;
        }
        .urdu-key:active { transform: scale(0.95); }
        .urdu-key span { 
            display: block; font-size: 12px; font-family: Arial, sans-serif; 
            color: #666; margin-top: 2px;
        }
        
        /* Separator line in keyboard */
        .key-separator {
            width: 100%; height: 1px; background-color: #ccc; margin: 8px 0;
        }
        
        @media print {
            body { margin: 0; background-color: white; }
            body > * { visibility: hidden; } 
            #document-editor {
                visibility: visible; position: absolute; left: 0; top: 0;
                width: 210mm; min-height: 297mm; margin: 0;
                box-shadow: none; border: none;
                padding: var(--page-margin-cm); overflow: visible !important;
            }
            #document-editor * { visibility: visible; }
            #document-editor::after { visibility: visible; }
            .page-break { height: 0; border: none !important; page-break-before: always; content: ''; }
            .page-break::after { content: none; }
        }
    </style>
</head>
<body>

    <h2>Ø§Ø±Ø¯Ùˆ Ø¢Ù† Ù„Ø§Ø¦Ù† ÚˆØ§Ú©ÙˆÙ…Ù†Ù¹ Ø§ÛŒÚˆÛŒÙ¹Ø± â€¢ Online Urdu Document Editor</h2>
    
    <div id="toolbars-container">
        <div id="rich-content-toolbar">
            <button class="tool-btn" onclick="insertImage()">ğŸ–¼ï¸ Image</button>
            <button class="tool-btn" onclick="insertTable()">ğŸ“… Table</button>
            <button class="tool-btn" onclick="insertShape()">â¬› Box</button>
            <button class="tool-btn" id="watermark-btn" onclick="setWatermark()">Â© Watermark</button>
            <button class="tool-btn" id="new-doc-btn" onclick="createNewDocument()">ğŸ“„ New Doc</button>
            <button class="tool-btn" id="pdf-btn" onclick="saveToPdf()">ğŸ“„ Save PDF</button> 
            <button class="tool-btn" onclick="saveDocument()">ğŸ’¾ Save HTML</button>
            <span id="save-status"></span>
        </div>

        <div id="formatting-toolbar">
            <button class="format-btn" id="bold-btn" onclick="formatDoc('bold')">B</button> 
            <input type="color" id="color-picker" title="Text Color" value="#333333">
            <select id="font-family-select" title="Font Family"><option value="" disabled selected>Font</option></select>
            <select id="font-size-select" title="Font Size"><option value="" disabled selected>Size</option></select>
            <button class="format-btn" onclick="formatDoc('justifyLeft')">â¬…ï¸</button>
            <button class="format-btn" onclick="formatDoc('justifyCenter')">â”</button>
            <button class="format-btn" onclick="formatDoc('justifyRight')">â¡ï¸</button>
            <button class="format-btn" onclick="formatDoc('insertUnorderedList')" title="Bullet Points">â€¢</button>
            <button class="format-btn" onclick="formatDoc('insertOrderedList')" title="Numbering 1, 2, 3">ğŸ”¢ 1.2.3</button>
        </div>
    </div>
    
    <div id="document-editor" contenteditable="true" dir="rtl" placeholder="ÛŒÛØ§Úº Ù„Ú©Ú¾Ù†Ø§ Ø´Ø±ÙˆØ¹ Ú©Ø±ÛŒÚº..." data-watermark=""></div>

    <div id="keyboard-container" dir="rtl">
        <button class="urdu-key" data-char="Ø§">Ø§<span>a</span></button>
        <button class="urdu-key" data-char="Ø¨">Ø¨<span>b</span></button>
        <button class="urdu-key" data-char="Ù¾">Ù¾<span>p</span></button>
        <button class="urdu-key" data-char="Øª">Øª<span>t</span></button>
        <button class="urdu-key" data-char="Ù¹">Ù¹<span>T</span></button>
        <button class="urdu-key" data-char="Ø«">Ø«<span>C</span></button>
        <button class="urdu-key" data-char="Ø¬">Ø¬<span>j</span></button>
        <button class="urdu-key" data-char="Ú†">Ú†<span>c</span></button>
        <button class="urdu-key" data-char="Ø­">Ø­<span>H</span></button>
        <button class="urdu-key" data-char="Ø®">Ø®<span>K</span></button>
        <button class="urdu-key" data-char="Ø¯">Ø¯<span>d</span></button>
        <button class="urdu-key" data-char="Úˆ">Úˆ<span>D</span></button>
        <button class="urdu-key" data-char="Ø°">Ø°<span>Z</span></button>
        <button class="urdu-key" data-char="Ø±">Ø±<span>r</span></button>
        <button class="urdu-key" data-char="Ú‘">Ú‘<span>R</span></button>
        <button class="urdu-key" data-char="Ø²">Ø²<span>z</span></button>
        <button class="urdu-key" data-char="Ø³">Ø³<span>s</span></button>
        <button class="urdu-key" data-char="Ø´">Ø´<span>S</span></button>
        <button class="urdu-key" data-char="Øµ">Øµ<span>q</span></button>
        <button class="urdu-key" data-char="Ø¶">Ø¶<span>X</span></button>
        <button class="urdu-key" data-char="Ø·">Ø·<span>I</span></button>
        <button class="urdu-key" data-char="Ø¸">Ø¸<span>O</span></button>
        <button class="urdu-key" data-char="Ø¹">Ø¹<span>e</span></button>
        <button class="urdu-key" data-char="Øº">Øº<span>G</span></button>
        <button class="urdu-key" data-char="Ù">Ù<span>f</span></button>
        <button class="urdu-key" data-char="Ù‚">Ù‚<span>Q</span></button>
        <button class="urdu-key" data-char="Ú©">Ú©<span>k</span></button>
        <button class="urdu-key" data-char="Ú¯">Ú¯<span>g</span></button>
        <button class="urdu-key" data-char="Ù„">Ù„<span>l</span></button>
        <button class="urdu-key" data-char="Ù…">Ù…<span>m</span></button>
        <button class="urdu-key" data-char="Ù†">Ù†<span>n</span></button>
        <button class="urdu-key" data-char="Úº">Úº<span>N</span></button>
        <button class="urdu-key" data-char="Ùˆ">Ùˆ<span>w</span></button>
        <button class="urdu-key" data-char="Û">Û<span>h</span></button>
        <button class="urdu-key" data-char="Ú¾">Ú¾<span>Hh</span></button>
        <button class="urdu-key" data-char="ÛŒ">ÛŒ<span>i</span></button>
        <button class="urdu-key" data-char="Û’">Û’<span>Y</span></button>
        <button class="urdu-key" data-char="Ø¦">Ø¦<span>E</span></button> 
        <button class="urdu-key" data-char="Ø¤">Ø¤<span>O</span></button>
        
        <div class="key-separator"></div>
        
        <button class="urdu-key space" data-char=" ">Space</button>
        <button class="urdu-key" data-char="Ø¡">Ø¡<span>'</span></button>
        <button class="urdu-key" data-char="Û”">Û”<span>.</span></button>
        <button class="urdu-key" data-char="ØŒ">ØŒ<span>,</span></button>
        <button class="urdu-key" data-char="Ø›">Ø›<span>;</span></button>
        <button class="urdu-key" data-char="ØŸ">ØŸ<span>?</span></button>
        <button class="urdu-key" data-char="!">!<span>!</span></button>
        <button class="urdu-key special" onclick="document.execCommand('undo')">â†©ï¸ Undo</button>
        <button class="urdu-key special" data-char="\n">â Enter</button>
        
        <div class="key-separator"></div>

        <div style="width: 100%; text-align: center; display: flex; justify-content: center; flex-wrap: wrap;">
             <button class="urdu-key" data-char="Û±">Û±<span>1</span></button>
             <button class="urdu-key" data-char="Û²">Û²<span>2</span></button>
             <button class="urdu-key" data-char="Û³">Û³<span>3</span></button>
             <button class="urdu-key" data-char="Û´">Û´<span>4</span></button>
             <button class="urdu-key" data-char="Ûµ">Ûµ<span>5</span></button>
             <button class="urdu-key" data-char="Û¶">Û¶<span>6</span></button>
             <button class="urdu-key" data-char="Û·">Û·<span>7</span></button>
             <button class="urdu-key" data-char="Û¸">Û¸<span>8</span></button>
             <button class="urdu-key" data-char="Û¹">Û¹<span>9</span></button>
             <button class="urdu-key" data-char="Û°">Û°<span>0</span></button>
        </div>
    </div>

<script>
    const editor = document.getElementById('document-editor');
    const keys = document.querySelectorAll('.urdu-key');
    const fontFamilySelect = document.getElementById('font-family-select');
    const colorPicker = document.getElementById('color-picker'); 
    const statusLabel = document.getElementById('save-status');

    const A4_HEIGHT_PX = 1123; 
    const STORAGE_KEY = 'urdu_editor_content_v2'; 

    // --- 1. Phonetic Mapping ---
    const phoneticMap = {
        'a': 'Ø§', 'b': 'Ø¨', 'p': 'Ù¾', 't': 'Øª', 'j': 'Ø¬', 'c': 'Ú†', 'H': 'Ø­', 
        'k': 'Ú©', 'g': 'Ú¯', 'l': 'Ù„', 'm': 'Ù…', 'n': 'Ù†', 'd': 'Ø¯', 'r': 'Ø±', 
        'z': 'Ø²', 's': 'Ø³', 'S': 'Ø´', 'x': 'Øµ', 'f': 'Ù', 'q': 'Ù‚', 
        'v': 'Ùˆ', 'w': 'Ùˆ', 'u': 'Ùˆ', 'i': 'ÛŒ', 'y': 'ÛŒ', 'e': 'Ø¹', 'h': 'Û', 
        'A': 'Ø¢', 'T': 'Ù¹', 'D': 'Úˆ', 'R': 'Ú‘', 'Z': 'Ø°', 'X': 'Ø¶', 
        'I': 'Ø·', 'E': 'Ø¦', 'G': 'Øº', 'N': 'Úº', 'O': 'Ø¤', 'Y': 'Û’', 
        'C': 'Ø«', "'": 'Ø¡', ';': 'Ø›', ',': 'ØŒ', '.': 'Û”', '?': 'ØŸ', 
        '0': 'Û°', '1': 'Û±', '2': 'Û²', '3': 'Û³', '4': 'Û´', 
        '5': 'Ûµ', '6': 'Û¶', '7': 'Û·', '8': 'Û¸', '9': 'Û¹'
    };

    // --- 2. Keyboard Event Listeners ---
    keys.forEach(key => {
        key.addEventListener('click', () => {
            const char = key.getAttribute('data-char');
            if (char) {
                editor.focus();
                document.execCommand('insertText', false, char);
                triggerInputEvent();
            }
        });
    });

    editor.addEventListener('keydown', (event) => {
        let key = event.key;
        let urduChar = null;

        if (event.shiftKey && phoneticMap.hasOwnProperty(key.toUpperCase())) {
            urduChar = phoneticMap[key.toUpperCase()];
        } else if (key === 'h' && event.shiftKey) {
            urduChar = 'Ú¾'; 
        } else if (phoneticMap.hasOwnProperty(key)) {
            urduChar = phoneticMap[key];
        }

        if (urduChar !== null && key.length === 1 && !event.ctrlKey && !event.altKey) {
            event.preventDefault(); 
            document.execCommand('insertText', false, urduChar);
        }
    });

    // --- 3. Auto-Save & Logic ---
    window.addEventListener('load', () => {
        initDropdowns();
        const savedContent = localStorage.getItem(STORAGE_KEY);
        const savedWatermark = localStorage.getItem(STORAGE_KEY + '_wm');
        
        if (savedContent && savedContent.trim() !== "") {
            editor.innerHTML = savedContent;
            statusLabel.textContent = "âœ“ Loaded";
            statusLabel.style.color = "green";
            checkPageBreak();
        }
        if (savedWatermark) {
            editor.setAttribute('data-watermark', savedWatermark);
        }
    });

    editor.addEventListener('input', () => {
        triggerInputEvent();
    });

    function triggerInputEvent() {
        localStorage.setItem(STORAGE_KEY, editor.innerHTML);
        localStorage.setItem(STORAGE_KEY + '_wm', editor.getAttribute('data-watermark') || "");
        statusLabel.textContent = "Saving...";
        statusLabel.style.color = "#e67e22"; 
        clearTimeout(window.saveTimer);
        window.saveTimer = setTimeout(() => {
            statusLabel.textContent = "âœ“ Saved";
            statusLabel.style.color = "green";
        }, 800);
        checkPageBreak();
    }

    function checkPageBreak() {
        const scrollHeight = editor.scrollHeight; 
        const requiredBreaks = Math.floor(scrollHeight / A4_HEIGHT_PX);
        const currentBreaks = editor.querySelectorAll('.page-break').length;
        if (currentBreaks < requiredBreaks) {
            const breakDiv = document.createElement('div');
            breakDiv.className = 'page-break';
            editor.appendChild(breakDiv);
        }
    }

    function createNewDocument() {
        if (confirm("Start new document? This clears current work.")) {
            editor.innerHTML = "";
            editor.setAttribute('data-watermark', ""); 
            localStorage.removeItem(STORAGE_KEY);
            localStorage.removeItem(STORAGE_KEY + '_wm');
            statusLabel.textContent = "New Doc";
            editor.focus();
        }
    }
    
    function setWatermark() {
        const current = editor.getAttribute('data-watermark') || "";
        const text = prompt("Enter Watermark Text (e.g., CONFIDENTIAL):", current);
        if (text !== null) {
            editor.setAttribute('data-watermark', text);
            triggerInputEvent(); 
        }
    }

    // --- 4. Formatting ---
    function formatDoc(command, value = null) {
        document.execCommand(command, false, value);
        editor.focus();
        triggerInputEvent();
    }

    function initDropdowns() {
        const fonts = [
            { name: 'Jameel Noori Nastaleeq', val: 'Jameel Noori Nastaleeq' },
            { name: 'Faiz Lahori', val: 'Faiz Lahori Nastaleeq' },
            { name: 'Arial', val: 'Arial' },
            { name: 'Courier New', val: 'Courier New' }
        ];
        fonts.forEach(f => {
            let opt = document.createElement('option');
            opt.value = f.val; opt.text = f.name;
            fontFamilySelect.add(opt);
        });
        for(let i=12; i<=72; i+=4) {
            let opt = document.createElement('option');
            opt.value = i; opt.text = i + 'px';
            document.getElementById('font-size-select').add(opt);
        }
    }
    
    document.getElementById('font-size-select').addEventListener('change', function() {
        if (this.value) {
            document.execCommand('fontSize', false, "7");
            const fontElements = editor.getElementsByTagName("font");
            for (let i = 0; i < fontElements.length; i++) {
                if (fontElements[i].size === "7") {
                    fontElements[i].removeAttribute("size");
                    fontElements[i].style.fontSize = this.value + "px";
                }
            }
            this.selectedIndex = 0;
            triggerInputEvent();
        }
    });

    fontFamilySelect.addEventListener('change', function() {
        formatDoc('fontName', this.value);
    });
    colorPicker.addEventListener('input', function() {
        formatDoc('foreColor', this.value);
    });

    // --- 5. Insertables ---
    function insertImage() {
        const input = document.createElement('input');
        input.type = 'file'; input.accept = 'image/*';
        input.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (r) => {
                    const html = `<img src="${r.target.result}" style="max-width:300px; float:right; margin:10px;">`;
                    document.execCommand('insertHTML', false, html);
                    triggerInputEvent();
                };
                reader.readAsDataURL(file);
            }
        };
        input.click();
    }

    function insertTable() {
        const html = `<table border="1" style="width:100%; border-collapse:collapse; margin:10px 0;">
            <tr><td style="padding:5px;">Data</td><td style="padding:5px;">Data</td></tr>
            <tr><td style="padding:5px;">Data</td><td style="padding:5px;">Data</td></tr>
        </table><br>`;
        document.execCommand('insertHTML', false, html);
        triggerInputEvent();
    }

    function insertShape() {
        const html = `<div style="border:2px solid #333; padding:15px; background:#eee; border-radius:5px; width:50%; margin:10px auto;">Box</div><br>`;
        document.execCommand('insertHTML', false, html);
        triggerInputEvent();
    }

    function saveDocument() {
        const blob = new Blob([editor.innerHTML], { type: 'text/html' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'urdu_doc.html';
        a.click();
    }

    function saveToPdf() {
        alert("Select 'Save as PDF' in the print window.");
        window.print();
    }
</script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Urdu Editor: Mobile Fixed Height</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jameel+Noori+Nastaleeq&display=swap" rel="stylesheet">
    
    <style>
        /* --- FONT DEFINITIONS --- */
        @font-face {
            font-family: 'Faiz Lahori Nastaleeq';
            src: url('fonts/Faiz_Lahori_Nastaleeq_Regular.ttf') format('truetype');
            font-weight: normal; font-style: normal;
        }

        :root {
            --bg-color: #f0f2f5;
            --toolbar-bg: #ffffff;
            --editor-bg: #ffffff;
            --key-bg: #ffffff;
            --primary-color: #5d98bc;
        }
        
        * { box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            height: 100vh; 
            overflow: hidden; 
        }

        /* --- HEADER / TOOLBARS --- */
        header {
            background: var(--toolbar-bg);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            z-index: 10;
            flex-shrink: 0;
        }

        h2 {
            text-align: center;
            color: #1a5276;
            font-family: 'Jameel Noori Nastaleeq', Arial, sans-serif;
            margin: 10px 0 5px 0;
            font-size: 1.2rem;
        }

        #toolbars-wrapper {
            display: flex;
            overflow-x: auto;
            padding: 5px 10px;
            gap: 10px;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        #toolbars-wrapper::-webkit-scrollbar { display: none; } 

        .toolbar-group {
            display: flex;
            gap: 5px;
            flex-shrink: 0;
            align-items: center;
            border-right: 1px solid #eee;
            padding-right: 10px;
        }
        .toolbar-group:last-child { border-right: none; }

        .tool-btn, .format-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        #font-size-select {
            padding: 6px;
            border-radius: 4px;
            border: 1px solid #ccc;
            background: white;
        }
        #color-picker {
            height: 30px; width: 30px;
            border: none; background: none;
            padding: 0;
        }

        /* --- EDITOR AREA --- */
        #editor-container {
            /* This container holds the fixed height editor */
            flex-grow: 1;
            padding: 20px 15px;
            background-color: #eef1f3;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Aligns editor to top */
        }

        #document-editor {
            width: 100%;
            max-width: 800px;
            
            /* --- FIXED HEIGHT SCROLL SETTINGS --- */
            height: 250px;        /* Exact height request */
            overflow-y: auto;     /* Vertical scroll */
            /* ------------------------------------ */

            background-color: var(--editor-bg);
            padding: 15px; 
            border: 1px solid #ccc; /* Added border to visualize the box */
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            direction: rtl; text-align: right;
            font-family: 'Jameel Noori Nastaleeq', sans-serif;
            font-size: 22px;
            line-height: 2;
            outline: none;
            position: relative;
        }

        #document-editor::after {
            content: attr(data-watermark);
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            font-size: 40px; 
            color: rgba(0, 0, 0, 0.08);
            white-space: nowrap; pointer-events: none;
            z-index: 0;
        }

        /* --- VIRTUAL KEYBOARD --- */
        #keyboard-container {
            background-color: #dce1e6;
            border-top: 1px solid #ccc;
            padding: 5px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 2px;
            /* Keyboard takes remaining space comfortably, or scrolls if needed */
            max-height: 45vh; 
            overflow-y: auto;
            flex-shrink: 0;
        }

        .urdu-key {
            background-color: var(--key-bg);
            color: #333;
            border: 1px solid #bbb;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Jameel Noori Nastaleeq', Arial, sans-serif;
            font-size: 18px;
            flex: 1 0 11%; 
            height: 45px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .urdu-key:active { background-color: #ccc; transform: scale(0.95); }
        .urdu-key span { font-size: 9px; color: #888; font-family: sans-serif; margin-top: -2px; }
        .urdu-key.space { flex: 1 0 40%; font-size: 14px; }
        .urdu-key.special { flex: 1 0 15%; background: #cddbe4; font-size: 12px; }
        
        @media (max-width: 350px) { .urdu-key span { display: none; } }

        /* --- PRINT / PDF STYLES (CRITICAL FOR A4) --- */
        @media print {
            body { 
                display: block; 
                height: auto; 
                overflow: visible; 
                background: white; 
                margin: 0;
            }
            
            /* Hide UI elements */
            header, #keyboard-container, #toolbars-wrapper { 
                display: none !important; 
            }

            #editor-container { 
                padding: 0; 
                margin: 0; 
                background: white; 
                display: block;
            }

            /* Force Editor to behave like A4 paper */
            #document-editor {
                height: auto !important;       /* Override the 250px limit */
                overflow: visible !important;  /* Remove scrollbars */
                width: 210mm !important;       /* A4 Width */
                min-height: 297mm !important;  /* A4 Height */
                border: none !important;
                box-shadow: none !important;
                padding: 2cm !important;       /* Standard print margins */
                margin: 0 auto !important;
            }
            
            #document-editor::after {
                font-size: 120px; /* Make watermark big for A4 */
            }
        }
    </style>
</head>
<body>

    <header>
        <h2>ÿßÿ±ÿØŸà ÿß€å⁄à€åŸπÿ±</h2>
        <div id="toolbars-wrapper">
            <div class="toolbar-group">
                <button class="tool-btn" onclick="createNewDocument()">üìÑ New</button>
                <button class="tool-btn" onclick="saveDocument()">üíæ Save</button>
                <button class="tool-btn" id="pdf-btn" onclick="saveToPdf()">üñ®Ô∏è PDF</button>
                <span id="save-status" style="font-size:10px; color:green;"></span>
            </div>
            <div class="toolbar-group">
                <button class="format-btn" onclick="formatDoc('bold')"><b>B</b></button>
                <select id="font-size-select"><option value="" disabled selected>Size</option></select>
                <input type="color" id="color-picker" value="#333333">
            </div>
            <div class="toolbar-group">
                <button class="format-btn" onclick="formatDoc('justifyRight')">‚û°Ô∏è</button>
                <button class="format-btn" onclick="formatDoc('justifyCenter')">‚îÅ</button>
                <button class="format-btn" onclick="formatDoc('justifyLeft')">‚¨ÖÔ∏è</button>
            </div>
            <div class="toolbar-group">
                <button class="tool-btn" onclick="insertImage()">üñºÔ∏è Img</button>
                <button class="tool-btn" onclick="insertTable()">üìÖ Tbl</button>
                <button class="tool-btn" onclick="setWatermark()">¬© WM</button>
            </div>
        </div>
    </header>
    
    <div id="editor-container">
        <div id="document-editor" contenteditable="true" dir="rtl" placeholder="€å€Åÿß⁄∫ ŸÑ⁄©⁄æ€å⁄∫..." data-watermark=""></div>
    </div>

    <div id="keyboard-container" dir="rtl">
        <button class="urdu-key" data-char="ÿß">ÿß<span>a</span></button>
        <button class="urdu-key" data-char="ÿ®">ÿ®<span>b</span></button>
        <button class="urdu-key" data-char="Ÿæ">Ÿæ<span>p</span></button>
        <button class="urdu-key" data-char="ÿ™">ÿ™<span>t</span></button>
        <button class="urdu-key" data-char="Ÿπ">Ÿπ<span>T</span></button>
        <button class="urdu-key" data-char="ÿ´">ÿ´<span>C</span></button>
        <button class="urdu-key" data-char="ÿ¨">ÿ¨<span>j</span></button>
        <button class="urdu-key" data-char="⁄Ü">⁄Ü<span>c</span></button>
        
        <button class="urdu-key" data-char="ÿ≠">ÿ≠<span>H</span></button>
        <button class="urdu-key" data-char="ÿÆ">ÿÆ<span>K</span></button>
        <button class="urdu-key" data-char="ÿØ">ÿØ<span>d</span></button>
        <button class="urdu-key" data-char="⁄à">⁄à<span>D</span></button>
        <button class="urdu-key" data-char="ÿ∞">ÿ∞<span>Z</span></button>
        <button class="urdu-key" data-char="ÿ±">ÿ±<span>r</span></button>
        <button class="urdu-key" data-char="⁄ë">⁄ë<span>R</span></button>
        <button class="urdu-key" data-char="ÿ≤">ÿ≤<span>z</span></button>

        <button class="urdu-key" data-char="ÿ≥">ÿ≥<span>s</span></button>
        <button class="urdu-key" data-char="ÿ¥">ÿ¥<span>S</span></button>
        <button class="urdu-key" data-char="ÿµ">ÿµ<span>q</span></button>
        <button class="urdu-key" data-char="ÿ∂">ÿ∂<span>X</span></button>
        <button class="urdu-key" data-char="ÿ∑">ÿ∑<span>I</span></button>
        <button class="urdu-key" data-char="ÿ∏">ÿ∏<span>O</span></button>
        <button class="urdu-key" data-char="ÿπ">ÿπ<span>e</span></button>
        <button class="urdu-key" data-char="ÿ∫">ÿ∫<span>G</span></button>

        <button class="urdu-key" data-char="ŸÅ">ŸÅ<span>f</span></button>
        <button class="urdu-key" data-char="ŸÇ">ŸÇ<span>Q</span></button>
        <button class="urdu-key" data-char="⁄©">⁄©<span>k</span></button>
        <button class="urdu-key" data-char="⁄Ø">⁄Ø<span>g</span></button>
        <button class="urdu-key" data-char="ŸÑ">ŸÑ<span>l</span></button>
        <button class="urdu-key" data-char="ŸÖ">ŸÖ<span>m</span></button>
        <button class="urdu-key" data-char="ŸÜ">ŸÜ<span>n</span></button>
        <button class="urdu-key" data-char="⁄∫">⁄∫<span>N</span></button>

        <button class="urdu-key" data-char="Ÿà">Ÿà<span>w</span></button>
        <button class="urdu-key" data-char="€Å">€Å<span>h</span></button>
        <button class="urdu-key" data-char="⁄æ">⁄æ<span>Hh</span></button>
        <button class="urdu-key" data-char="€å">€å<span>i</span></button>
        <button class="urdu-key" data-char="€í">€í<span>Y</span></button>
        <button class="urdu-key" data-char="ÿ¶">ÿ¶<span>E</span></button> 
        <button class="urdu-key" data-char="ÿ§">ÿ§<span>O</span></button>
        <button class="urdu-key special" onclick="document.execCommand('undo')">Undo</button>

        <button class="urdu-key" data-char="€î">€î</button>
        <button class="urdu-key" data-char="ÿå">ÿå</button>
        <button class="urdu-key space" data-char=" ">Space</button>
        <button class="urdu-key special" data-char="\n">‚èé</button>
        <button class="urdu-key" data-char="ÿü">ÿü</button>
        
        <div style="display:flex; width:100%; justify-content:center; margin-top:5px;">
            <button class="urdu-key" data-char="€±">€±</button>
            <button class="urdu-key" data-char="€≤">€≤</button>
            <button class="urdu-key" data-char="€≥">€≥</button>
            <button class="urdu-key" data-char="€¥">€¥</button>
            <button class="urdu-key" data-char="€µ">€µ</button>
        </div>
    </div>

<script>
    const editor = document.getElementById('document-editor');
    const keys = document.querySelectorAll('.urdu-key');
    const statusLabel = document.getElementById('save-status');
    const STORAGE_KEY = 'urdu_editor_mobile_v3'; 

    // --- Phonetic Map ---
    const phoneticMap = {
        'a': 'ÿß', 'b': 'ÿ®', 'p': 'Ÿæ', 't': 'ÿ™', 'j': 'ÿ¨', 'c': '⁄Ü', 'H': 'ÿ≠', 
        'k': '⁄©', 'g': '⁄Ø', 'l': 'ŸÑ', 'm': 'ŸÖ', 'n': 'ŸÜ', 'd': 'ÿØ', 'r': 'ÿ±', 
        'z': 'ÿ≤', 's': 'ÿ≥', 'S': 'ÿ¥', 'x': 'ÿµ', 'f': 'ŸÅ', 'q': 'ŸÇ', 
        'v': 'Ÿà', 'w': 'Ÿà', 'u': 'Ÿà', 'i': '€å', 'y': '€å', 'e': 'ÿπ', 'h': '€Å', 
        'A': 'ÿ¢', 'T': 'Ÿπ', 'D': '⁄à', 'R': '⁄ë', 'Z': 'ÿ∞', 'X': 'ÿ∂', 
        'I': 'ÿ∑', 'E': 'ÿ¶', 'G': 'ÿ∫', 'N': '⁄∫', 'O': 'ÿ§', 'Y': '€í', 
        'C': 'ÿ´', "'": 'ÿ°', ';': 'ÿõ', ',': 'ÿå', '.': '€î', '?': 'ÿü', 
        '0': '€∞', '1': '€±', '2': '€≤', '3': '€≥', '4': '€¥', 
        '5': '€µ', '6': '€∂', '7': '€∑', '8': '€∏', '9': '€π'
    };

    // --- Keyboard Logic ---
    keys.forEach(key => {
        key.addEventListener('click', (e) => {
            e.preventDefault();
            const char = key.getAttribute('data-char');
            if (char) {
                editor.focus();
                document.execCommand('insertText', false, char);
                triggerInputEvent();
            }
        });
    });

    editor.addEventListener('keydown', (event) => {
        let key = event.key;
        let urduChar = null;
        if (event.shiftKey && phoneticMap.hasOwnProperty(key.toUpperCase())) {
            urduChar = phoneticMap[key.toUpperCase()];
        } else if (key === 'h' && event.shiftKey) {
            urduChar = '⁄æ'; 
        } else if (phoneticMap.hasOwnProperty(key)) {
            urduChar = phoneticMap[key];
        }

        if (urduChar !== null && key.length === 1 && !event.ctrlKey && !event.altKey) {
            event.preventDefault(); 
            document.execCommand('insertText', false, urduChar);
        }
    });

    // --- Save/Load ---
    window.addEventListener('load', () => {
        initDropdowns();
        const savedContent = localStorage.getItem(STORAGE_KEY);
        const savedWatermark = localStorage.getItem(STORAGE_KEY + '_wm');
        
        if (savedContent && savedContent.trim() !== "") {
            editor.innerHTML = savedContent;
            statusLabel.textContent = "‚úì Loaded";
        }
        if (savedWatermark) {
            editor.setAttribute('data-watermark', savedWatermark);
        }
    });

    function triggerInputEvent() {
        localStorage.setItem(STORAGE_KEY, editor.innerHTML);
        localStorage.setItem(STORAGE_KEY + '_wm', editor.getAttribute('data-watermark') || "");
        statusLabel.textContent = "Saving...";
        clearTimeout(window.saveTimer);
        window.saveTimer = setTimeout(() => {
            statusLabel.textContent = "‚úì Saved";
        }, 800);
    }

    editor.addEventListener('input', triggerInputEvent);

    // --- Tools ---
    function createNewDocument() {
        if (confirm("Start new document?")) {
            editor.innerHTML = "";
            editor.setAttribute('data-watermark', ""); 
            localStorage.removeItem(STORAGE_KEY);
            statusLabel.textContent = "New";
            editor.focus();
        }
    }

    function setWatermark() {
        const current = editor.getAttribute('data-watermark') || "";
        const text = prompt("Watermark Text:", current);
        if (text !== null) {
            editor.setAttribute('data-watermark', text);
            triggerInputEvent();
        }
    }

    function formatDoc(command, value = null) {
        document.execCommand(command, false, value);
        editor.focus();
        triggerInputEvent();
    }

    function initDropdowns() {
        const sizeSelect = document.getElementById('font-size-select');
        for(let i=14; i<=48; i+=2) {
            let opt = document.createElement('option');
            opt.value = i; opt.text = i + 'px';
            sizeSelect.add(opt);
        }
    }
    
    document.getElementById('font-size-select').addEventListener('change', function() {
        if (this.value) {
            document.execCommand('fontSize', false, "7");
            const fontElements = editor.getElementsByTagName("font");
            for (let i = 0; i < fontElements.length; i++) {
                if (fontElements[i].size === "7") {
                    fontElements[i].removeAttribute("size");
                    fontElements[i].style.fontSize = this.value + "px";
                }
            }
            this.selectedIndex = 0;
            triggerInputEvent();
        }
    });

    document.getElementById('color-picker').addEventListener('input', function() {
        formatDoc('foreColor', this.value);
    });

    function insertImage() {
        const input = document.createElement('input');
        input.type = 'file'; input.accept = 'image/*';
        input.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (r) => {
                    const html = `<img src="${r.target.result}" style="max-width:90%; float:right; margin:10px;">`;
                    document.execCommand('insertHTML', false, html);
                    triggerInputEvent();
                };
                reader.readAsDataURL(file);
            }
        };
        input.click();
    }

    function insertTable() {
        const html = `<table border="1" style="width:100%; border-collapse:collapse; margin:10px 0;">
            <tr><td style="padding:5px;">..</td><td style="padding:5px;">..</td></tr>
            <tr><td style="padding:5px;">..</td><td style="padding:5px;">..</td></tr>
        </table><br>`;
        document.execCommand('insertHTML', false, html);
        triggerInputEvent();
    }

    function saveDocument() {
        const blob = new Blob([editor.innerHTML], { type: 'text/html' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'urdu_note.html';
        a.click();
    }

    function saveToPdf() {
        // Trigger the browser's print functionality, 
        // handled by @media print in CSS
        window.print();
    }
</script>
</body>
</html>